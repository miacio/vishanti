<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>upload file test</title>
        <script src="../js/jquery-3.6.4.min.js"></script>
        <script src="../js/spark-md5.min.js"></script>
    </head>
    <body>
        <h1>upload file test</h1>
            token: <input id="token" value="4F00499AB963499F8282C2E7F227561E" type="text" name="token"> <br>
            region: <input id="region" value="miajio" type="text" name="region"> <br>
            File: <input id="file" type="file" name="file"><br>
            MD5: <input id="md5" type="text" name="md5"><br>
            <input type="button" value="submit" id="subbt">
        <script>
            document.getElementById('file').addEventListener('change', e => {
                const file = e.target.files[0];
                const fileReader = new FileReader()
                try {
                    fileReader.readAsBinaryString(file);
                    fileReader.onload = e => {
                        const md5 = SparkMD5.hashBinary(e.target.result);
                        console.log(md5);
                        $("#md5").val(md5)
                    }
                } catch(err) {
                    $("#md5").val("")
                }
            });

            $(function(){
                function fileUpload() {
                    var data = new FormData();
                    data.append("region", $("#region").val());
                    data.append("md5", $("#md5").val());
                    data.append("file", $("#file").prop("files")[0]);

                    $.ajax({
                        url: "/file/upload",
                        type: "POST",
                        data: data,
                        cache: false,
                        processData: false,
                        contentType: false,
                        beforeSend: function(req) {
                            req.setRequestHeader("token", $("#token").val());
                        },
                        success: function(data) {
                            console.log(data.data);
                            
                        }
                    });
                }

                $("#subbt").click(fileUpload)
            })
        </script>
    </body>
</html>