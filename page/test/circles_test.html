<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>circles test</title>
    <script src="../js/jquery-3.6.4.min.js"></script>
    <script src="../js/spark-md5.min.js"></script>
    <style>
        pre {
            white-space: pre-wrap;
        }
    </style>
</head>

<body>
    <fieldset>
        <legend><h1>create circles test</h1></legend>
        <div>
            token: <input id="token" value="" type="text" name="token">
        </div>
        <div>
            region:
            <input type="radio" name="region" value="miajiodb" checked>
            <label for="miajiodb">miajiodb</label>
            <input type="radio" name="region" value="beijing">
            <label for="beijing">beijing</label>
            <input type="radio" name="region" value="hangzhou">
            <label for="hangzhou">hangzhou</label>
        </div>
        <div>
            Logo: <input id="file" type="file" name="file">
        </div>
        <div>
            MD5: <input id="md5" type="text" name="md5">
        </div>
        <div>
            Name: <input id="name" type="text" name="name">
        </div>
        <div>
            Descibe: <input id="describe" type="text" name="describe">
        </div>
        <div>
            <input type="button" value="create-circles-button" id="create-circles-button">
            <input type="button" value="find-my-circles" id="find-my-circles">
        </div>
    </fieldset>

    <fieldset>
        <legend><h1>invite join test</h1></legend>
        <div>
            Token: <input type="text" name="invite-join-circles-token" id="invite-join-circles-token">
        </div>
        <div>
            CirclesId: <input type="text" name="invite-join-circles-id" id="invite-join-circles-id">
        </div>
        <div>
            UserAccount: <input type="text" name="invite-join-user-account" id="invite-join-user-account">
        </div>
        <div>
            <input type="button" id="invite-join-button" value="invite-join-button">
        </div>
    </fieldset>

    <fieldset>
        <legend><h1>request join test</h1></legend>
        <div>
            Token: <input type="text" name="request-join-circles-token" id="request-join-circles-token">
        </div>
        <div>
            CirclesId: <input type="text" name="request-join-circles-id" id="request-join-circles-id">
        </div>
        <div>
            <input type="button" id="request-join-button" value="request-join-button">
        </div>
    </fieldset>
    <fieldset>
        <legend><h1>find my join test</h1></legend>
        <div>
            Token: <input type="text" name="find-my-join-circles-token" id="find-my-join-circles-token">
        </div>
        <div>
            <input type="button" id="find-my-join-circles-button" value="find-my-join-circles-button">
        </div>
    </fieldset>

    <fieldset>
        <legend><h1>query my circles request join users test</h1></legend>
        <div>
            Token: <input type="text" name="query-my-circles-request-join-token" id="query-my-circles-request-join-token">
        </div>
        <div>
            <input type="button" id="query-my-circles-request-join-button" value="query-my-circles-request-join-button">
        </div>
    </fieldset>

    <fieldset>
        <legend><h1>query my circles invite join users test</h1></legend>
        <div>
            Token: <input type="text" name="query-my-circles-invite-join-token" id="query-my-circles-invite-join-token">
        </div>
        <div>
            <input type="button" id="query-my-circles-invite-join-button" value="query-my-circles-invite-join-button">
        </div>
    </fieldset>

    <div>
        <pre id="result">
        </pre>
    </div>
    <script>
         document.getElementById('file').addEventListener('change', e => {
            const file = e.target.files[0];
            const fileReader = new FileReader()
            try {
                fileReader.readAsBinaryString(file);
                fileReader.onload = e => {
                    const md5 = SparkMD5.hashBinary(e.target.result);
                    console.log(md5);
                    $("#md5").val(md5)
                }
            } catch (err) {
                $("#md5").val("")
            }
        });
        $(function() {
            function createCircles() {
                var formData = new FormData();
                formData.append("region", $("input[name='region']:checked").val());
                formData.append("md5", $("#md5").val());
                formData.append("file", $("#file").prop("files")[0]);
                formData.append("name", $("#name").val());
                formData.append("describe", $("#describe").val());

                $.ajax({
                    url: "/circles/create",
                    type: "POST",
                    data: formData,
                    cache: false,
                    processData: false,
                    contentType: false,
                    beforeSend: function (req) {
                        req.setRequestHeader("token", $("#token").val());
                    },
                    success: function (data) {
                        console.log(data);
                        console.log(data.data);
                        $("#result").text(JSON.stringify(data, null, 2))
                    }
                });
            }

            function findCircles() {
                $.ajax({
                    url: "/circles/find",
                    type: "GET",
                    cache: false,
                    processData: false,
                    contentType: false,
                    beforeSend: function (req) {
                        req.setRequestHeader("token", $("#token").val());
                    },
                    success: function (data) {
                        console.log(data);
                        console.log(data.data);
                        $("#result").text(JSON.stringify(data, null, 2))
                    }
                });
            }


            function inviteJoin() {
                var formData = new FormData()
                formData.append("circles_id", $("#invite-join-circles-id").val())
                formData.append("user_account", $("#invite-join-user-account").val())

                $.ajax({
                    url: "/circles/inviteJoin",
                    type: "POST",
                    data: formData,
                    cache: false,
                    processData: false,
                    contentType: false,
                    beforeSend: function (req) {
                        req.setRequestHeader("token", $("#invite-join-circles-token").val());
                    },
                    success: function (data) {
                        console.log(data);
                        console.log(data.data);
                        $("#result").text(JSON.stringify(data, null, 2))

                    }
                })
            }

            function requestJoin() {
                var formData = new FormData()
                formData.append("circles_id", $("#request-join-circles-id").val())

                $.ajax({
                    url: "/circles/requestJoin",
                    type: "POST",
                    data: formData,
                    cache: false,
                    processData: false,
                    contentType: false,
                    beforeSend: function (req) {
                        req.setRequestHeader("token", $("#request-join-circles-token").val());
                    },
                    success: function (data) {
                        console.log(data);
                        console.log(data.data);
                        $("#result").text(JSON.stringify(data, null, 2))

                    }
                })
            }

            function findMyJoin() {
                $.ajax({
                    url: "/circles/findMyJoin",
                    type: "GET",
                    cache: false,
                    processData: false,
                    contentType: false,
                    beforeSend: function (req) {
                        req.setRequestHeader("token", $("#find-my-join-circles-token").val());
                    },
                    success: function (data) {
                        console.log(data);
                        console.log(data.data);
                        $("#result").text(JSON.stringify(data, null, 2))
                    }
                })
            }

            function queryMyCirclesRequestJoin() {
                $.ajax({
                    url: "/circles/queryRequestJoin",
                    type: "GET",
                    cache: false,
                    processData: false,
                    contentType: false,
                    beforeSend: function (req) {
                        req.setRequestHeader("token", $("#query-my-circles-request-join-token").val());
                    },
                    success: function (data) {
                        console.log(data);
                        console.log(data.data);
                        $("#result").text(JSON.stringify(data, null, 2))
                    }
                })
            }

            function queryMyCirclesInviteJoin() {
                $.ajax({
                    url: "/circles/queryInviteJoin",
                    type: "GET",
                    cache: false,
                    processData: false,
                    contentType: false,
                    beforeSend: function (req) {
                        req.setRequestHeader("token", $("#query-my-circles-invite-join-token").val());
                    },
                    success: function (data) {
                        console.log(data);
                        console.log(data.data);
                        $("#result").text(JSON.stringify(data, null, 2))
                    }
                })
            }

            $("#create-circles-button").click(createCircles)
            $("#find-my-circles").click(findCircles)
            $("#invite-join-button").click(inviteJoin)
            $("#request-join-button").click(requestJoin)
            $("#find-my-join-circles-button").click(findMyJoin)
            $("#query-my-circles-request-join-button").click(queryMyCirclesRequestJoin)
            $("#query-my-circles-invite-join-button").click(queryMyCirclesInviteJoin)
        });

    </script>
</body>
</html>